<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dopes Fitness - Pay Now</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      text-align: center;
      padding: 60px 20px;
    }
    .btn {
      padding: 14px 32px;
      background: #111;
      color: #fff;
      border-radius: 5px;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
    }
    .btn:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <h1>Subscribe & Pay</h1>
  <p>Get started with Dopes Fitness subscription!</p>
  <button class="btn" id="payBtn">Pay ‚Çπ50</button>

  <script>
    document.getElementById('payBtn').onclick = async function (e) {
      e.preventDefault();

      // ‚úÖ Step 1: Create order via your backend
      const response = await fetch("https://fitness-app-rl7q.onrender.com/create-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          amount: 50, // Amount in rupees
          currency: "INR",
          receipt: "rcpt_" + Date.now()
        }),
      });

      const order = await response.json();
      if (!order.success) {
        alert("‚ö†Ô∏è Failed to create order.");
        return;
      }

      // ‚úÖ Step 2: Open Razorpay Checkout
      const options = {
        key: "rzp_live_RKB5wpngUC57hu", // Your Razorpay Key ID
        amount: order.amount,
        currency: order.currency,
        name: "Dopes Fitness",
        description: "Subscription Payment",
        order_id: order.order_id, // <- generated by backend
        handler: async function (response) {
          alert("‚úÖ Payment Authorized: " + response.razorpay_payment_id);

          // ‚úÖ Step 3: Verify payment on backend
          const verifyRes = await fetch("https://fitness-app-rl7q.onrender.com/verify-payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(response)
          });
          const verifyData = await verifyRes.json();

          if (verifyData.success) {
            alert("üéâ Payment verified successfully!");

            // ‚úÖ Step 4: Create invoice (optional but useful)
            const invoiceRes = await fetch("https://fitness-app-rl7q.onrender.com/create-invoice", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                customer_name: "Vignesh Araya",
                customer_email: "vignesh@example.com",
                amount: 50,
                order_id: order.order_id
              })
            });

            const invoiceData = await invoiceRes.json();
            if (invoiceData.success) {
              alert("üßæ Invoice generated successfully!\nInvoice ID: " + invoiceData.invoice_id);
              window.open(invoiceData.short_url, "_blank");
            } else {
              alert("‚ö†Ô∏è Invoice creation failed!");
            }
          } else {
            alert("‚ùå Payment verification failed!");
          }
        },
        theme: { color: "#111" }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    };
  </script>
</body>
</html>
